// Vencord cb3bd4b
// Standalone: false
// Platform: win32
"use strict";var Ke=Object.create;var Tr=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Ye=Object.getPrototypeOf,be=Object.prototype.hasOwnProperty;var w=(r,e)=>()=>(r&&(e=r(r=0)),e);var Yr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of qe(e))!be.call(r,i)&&i!==t&&Tr(r,i,{get:()=>e[i],enumerable:!(n=He(e,i))||n.enumerable});return r};var Er=(r,e,t)=>(t=r!=null?Ke(Ye(r)):{},Yr(e||!r||!r.__esModule?Tr(t,"default",{value:r,enumerable:!0}):t,r)),br=r=>Yr(Tr({},"__esModule",{value:!0}),r);var f=w(()=>{"use strict"});function Qe(r){let e={};for(let t in r)e[t]=r[t],e[r[t]]=t;return Object.freeze(e)}var d,Dr=w(()=>{"use strict";f();d=Qe({QUICK_CSS_UPDATE:"VencordQuickCssUpdate",GET_QUICK_CSS:"VencordGetQuickCss",SET_QUICK_CSS:"VencordSetQuickCss",GET_SETTINGS_DIR:"VencordGetSettingsDir",GET_SETTINGS:"VencordGetSettings",SET_SETTINGS:"VencordSetSettings",OPEN_EXTERNAL:"VencordOpenExternal",OPEN_QUICKCSS:"VencordOpenQuickCss",GET_UPDATES:"VencordGetUpdates",GET_REPO:"VencordGetRepo",UPDATE:"VencordUpdate",BUILD:"VencordBuild",OPEN_MONACO_EDITOR:"VencordOpenMonacoEditor"})});function or(r){return async function(){try{return{ok:!0,value:await r(...arguments)}}catch(e){return{ok:!1,error:e instanceof Error?{...e}:e}}}}var Qr=w(()=>{"use strict";f()});var et={};function pr(...r){let e={cwd:re};return zr?Pr("flatpak-spawn",["--host","git",...r],e):Pr("git",r,e)}async function Je(){return(await pr("remote","get-url","origin")).stdout.trim().replace(/git@(.+):/,"https://$1/").replace(/\.git$/,"")}async function Xe(){await pr("fetch");let e=(await pr("log","HEAD...origin/main","--pretty=format:%an/%h/%s")).stdout.trim();return e?e.split(`
`).map(t=>{let[n,i,...o]=t.split("/");return{hash:i,author:n,message:o.join("/")}}):[]}async function $e(){return(await pr("pull")).stdout.includes("Fast-forward")}async function rt(){return!(await Pr(zr?"flatpak-spawn":"node",zr?["--host","node","scripts/build/build.mjs"]:["scripts/build/build.mjs"],{cwd:re})).stderr.includes("Build failed")}var Jr,ar,Xr,$r,re,Pr,zr,ee=w(()=>{"use strict";f();Dr();Jr=require("child_process"),ar=require("electron"),Xr=require("path"),$r=require("util");Qr();re=(0,Xr.join)(__dirname,".."),Pr=(0,$r.promisify)(Jr.execFile),zr=!1;ar.ipcMain.handle(d.GET_REPO,or(Je));ar.ipcMain.handle(d.GET_UPDATES,or(Xe));ar.ipcMain.handle(d.UPDATE,or($e));ar.ipcMain.handle(d.BUILD,or(rt))});var te=w(()=>{"use strict";f();Promise.resolve().then(()=>ee())});function ne(r,e=300){let t;return function(...n){clearTimeout(t),t=setTimeout(()=>{r(...n)},e)}}var ie=w(()=>{"use strict";f()});var sr,oe=w(()=>{"use strict";f();sr=class{constructor(e=1/0){this.maxSize=e}queue=[];promise;next(){let e=this.queue.shift();e?this.promise=Promise.resolve().then(e).finally(()=>this.next()):this.promise=void 0}run(){this.promise||this.next()}push(e){this.size>=this.maxSize&&this.queue.shift(),this.queue.push(e),this.run()}unshift(e){this.size>=this.maxSize&&this.queue.pop(),this.queue.unshift(e),this.run()}get size(){return this.queue.length}}});var ae,se=w(()=>{f();ae="PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogICAgPHRpdGxlPlZlbmNvcmQgUXVpY2tDU1MgRWRpdG9yPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgZGF0YS1uYW1lPSJ2cy9lZGl0b3IvZWRpdG9yLm1haW4iCiAgICAgICAgaHJlZj0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbW9uYWNvLWVkaXRvci8wLjM0LjAvbWluL3ZzL2VkaXRvci9lZGl0b3IubWFpbi5taW4uY3NzIj4KICAgIDxzdHlsZT4KICAgICAgICBodG1sLAogICAgICAgIGJvZHksCiAgICAgICAgI2NvbnRhaW5lciB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgoKPGJvZHk+CiAgICA8ZGl2IGlkPSJjb250YWluZXIiPjwvZGl2PgogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL21vbmFjby1lZGl0b3IvMC4zNC4wL21pbi92cy9sb2FkZXIubWluLmpzIj48L3NjcmlwdD4KCiAgICA8c2NyaXB0PgogICAgICAgIHJlcXVpcmUuY29uZmlnKHsgcGF0aHM6IHsgJ3ZzJzogJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL21vbmFjby1lZGl0b3IvMC4zNC4wL21pbi92cycgfSB9KTsKICAgICAgICByZXF1aXJlKFsidnMvZWRpdG9yL2VkaXRvci5tYWluIl0sICgpID0+IHsKICAgICAgICAgICAgZ2V0Q3VycmVudENzcygpLnRoZW4oY3NzID0+IHsKICAgICAgICAgICAgICAgIHZhciBlZGl0b3IgPSBtb25hY28uZWRpdG9yLmNyZWF0ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY3NzLAogICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAnY3NzJywKICAgICAgICAgICAgICAgICAgICB0aGVtZTogZ2V0VGhlbWUoKSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZWRpdG9yLm9uRGlkQ2hhbmdlTW9kZWxDb250ZW50KCgpID0+CiAgICAgICAgICAgICAgICAgICAgc2V0Q3NzKGVkaXRvci5nZXRWYWx1ZSgpKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBtb25hY28gcmUtbGF5b3V0CiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmxheW91dCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKCiAgICA8L3NjcmlwdD4KPC9ib2R5PgoKPC9odG1sPgo="});var ce,b,Rr,cr,Q,Gr,ue,vr,ur=w(()=>{"use strict";f();ce=require("electron"),b=require("path"),Rr=process.env.VENCORD_USER_DATA_DIR??(process.env.DISCORD_USER_DATA_DIR?(0,b.join)(process.env.DISCORD_USER_DATA_DIR,"..","VencordData"):(0,b.join)(ce.app.getPath("userData"),"..","Vencord")),cr=(0,b.join)(Rr,"settings"),Q=(0,b.join)(cr,"quickCss.css"),Gr=(0,b.join)(cr,"settings.json"),ue=["https:","http:","steam:","spotify:"],vr=process.argv.includes("--vanilla")});function le(){return(0,_.readFile)(Q,"utf-8").catch(()=>"")}function he(){try{return(0,J.readFileSync)(Gr,"utf-8")}catch{return"{}"}}function gr(){try{return JSON.parse(he())}catch{return{}}}function pe(r){(0,_.open)(Q,"a+").then(e=>{e.close(),(0,J.watch)(Q,{persistent:!1},ne(async()=>{r.webContents.postMessage(d.QUICK_CSS_UPDATE,await le())},50))})}var A,J,_,fe,tt,nt,Or=w(()=>{"use strict";f();te();ie();Dr();oe();A=require("electron"),J=require("fs"),_=require("fs/promises"),fe=require("path");se();ur();(0,J.mkdirSync)(cr,{recursive:!0});A.ipcMain.handle(d.OPEN_QUICKCSS,()=>A.shell.openPath(Q));A.ipcMain.handle(d.OPEN_EXTERNAL,(r,e)=>{try{var{protocol:t}=new URL(e)}catch{throw"Malformed URL"}if(!ue.includes(t))throw"Disallowed protocol.";A.shell.openExternal(e)});tt=new sr,nt=new sr;A.ipcMain.handle(d.GET_QUICK_CSS,()=>le());A.ipcMain.handle(d.SET_QUICK_CSS,(r,e)=>tt.push(()=>(0,_.writeFile)(Q,e)));A.ipcMain.handle(d.GET_SETTINGS_DIR,()=>cr);A.ipcMain.on(d.GET_SETTINGS,r=>r.returnValue=he());A.ipcMain.handle(d.SET_SETTINGS,(r,e)=>{nt.push(()=>(0,_.writeFile)(Gr,e))});A.ipcMain.handle(d.OPEN_MONACO_EDITOR,async()=>{await new A.BrowserWindow({title:"Vencord QuickCSS Editor",autoHideMenuBar:!0,darkTheme:!0,webPreferences:{preload:(0,fe.join)(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1}}).loadURL(`data:text/html;base64,${ae}`)})});function Ze(r,e,t){let n=e;if(e in r)return void t(r[n]);Object.defineProperty(r,e,{set(i){delete r[n],r[n]=i,t(i)},configurable:!0,enumerable:!1})}var Ue=w(()=>{"use strict";f()});var Tt={};function xt(r,e){let t=r.slice(4).split(".").map(Number),n=e.slice(4).split(".").map(Number);for(let i=0;i<n.length;i++){if(t[i]>n[i])return!0;if(t[i]<n[i])return!1}return!1}function Fe(){try{let r=(0,x.dirname)(process.execPath),e=(0,x.basename)(r),t=(0,x.join)(r,".."),n=(0,S.readdirSync)(t).reduce((c,a)=>a.startsWith("app-")&&xt(a,c)?a:c,e);if(n===e)return;let i=(0,x.join)(t,n,"resources"),o=(0,x.join)(i,"app.asar"),s=(0,x.join)(i,"_app.asar");if(!(0,S.existsSync)(o)||(0,S.statSync)(o).isDirectory())return;console.info("[Vencord] Detected Host Update. Repatching..."),(0,S.renameSync)(o,s),(0,S.mkdirSync)(o),(0,S.writeFileSync)((0,x.join)(o,"package.json"),JSON.stringify({name:"discord",main:"index.js"})),(0,S.writeFileSync)((0,x.join)(o,"index.js"),`require(${JSON.stringify((0,x.join)(__dirname,"patcher.js"))});`)}catch(r){console.error("[Vencord] Failed to repatch latest host update",r)}}function St(){try{let r=(0,x.join)(require.main.filename,"..","autoStart","win32.js"),{update:e}=require(r);require.cache[r].exports.update=function(){e.apply(this,arguments),Fe()}}catch{let{quitAndInstall:r}=j.autoUpdater;j.autoUpdater.quitAndInstall=function(){Fe(),r.call(this)}}}var j,S,x,Ve,Le=w(()=>{"use strict";f();j=require("electron"),S=require("fs"),x=require("path"),{setAppUserModelId:Ve}=j.app;j.app.setAppUserModelId=function(r){j.app.setAppUserModelId=Ve,Ve.call(this,r),St()}});var zt={};var z,F,Et,Dt,Mr,Pt,Me=w(()=>{"use strict";f();Ue();z=Er(require("electron")),F=require("path");Or();ur();console.log("[Vencord] Starting up...");Et=require.main.filename,Dt=require.main.path.endsWith("app.asar")?"_app.asar":"app.asar",Mr=(0,F.join)((0,F.dirname)(Et),"..",Dt),Pt=require((0,F.join)(Mr,"package.json"));require.main.filename=(0,F.join)(Mr,Pt.main);z.app.setAppPath(Mr);if(vr)console.log("[Vencord] Running in vanilla mode. Not loading Vencord");else{let r=gr();if(Le(),r.winCtrlQ){let n=z.Menu.buildFromTemplate;z.Menu.buildFromTemplate=function(i){if(i[0]?.label==="&File"){let{submenu:o}=i[0];Array.isArray(o)&&o.push({label:"Quit (Hidden)",visible:!1,acceleratorWorksWhenHidden:!0,accelerator:"Control+Q",click:()=>z.app.quit()})}return n.call(this,i)}}class e extends z.default.BrowserWindow{constructor(i){if(i?.webPreferences?.preload&&i.title){let o=i.webPreferences.preload;i.webPreferences.preload=(0,F.join)(__dirname,"preload.js"),i.webPreferences.sandbox=!1,r.frameless?i.frame=!1:r.winNativeTitleBar&&delete i.frame,r.transparentUNSAFE_USE_AT_OWN_RISK&&(i.transparent=!0,i.backgroundColor="#00000000"),r.macosTranslucency,process.env.DISCORD_PRELOAD=o,super(i),pe(this)}else super(i)}}Object.assign(e,z.default.BrowserWindow),Object.defineProperty(e,"name",{value:"BrowserWindow",configurable:!0});let t=require.resolve("electron");delete require.cache[t].exports,require.cache[t].exports={...z.default,BrowserWindow:e},Ze(global,"appSettings",n=>{n.set("DANGEROUS_ENABLE_DEVTOOLS_ONLY_ENABLE_IF_YOU_KNOW_WHAT_YOURE_DOING",!0),r.disableMinSize?(n.set("MIN_WIDTH",0),n.set("MIN_HEIGHT",0)):(n.set("MIN_WIDTH",940),n.set("MIN_HEIGHT",500))}),process.env.DATA_DIR=(0,F.join)(z.app.getPath("userData"),"..","Vencord")}console.log("[Vencord] Loading original Discord app.asar");require(require.main.filename)});f();var B=require("electron"),_e=require("path");Or();ur();f();var Ne=require("electron");f();var me=require("module"),it=(0,me.createRequire)("/"),Ir,ot=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{Ir=it("worker_threads").Worker}catch{}var at=Ir?function(r,e,t,n,i){var o=!1,s=new Ir(r+ot,{eval:!0}).on("error",function(c){return i(c,null)}).on("message",function(c){return i(null,c)}).on("exit",function(c){c&&!o&&i(new Error("exited with code "+c),null)});return s.postMessage(t,n),s.terminate=function(){return o=!0,Ir.prototype.terminate.call(s)},s}:function(r,e,t,n,i){setImmediate(function(){return i(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var o=function(){};return{terminate:o,postMessage:o}},C=Uint8Array,V=Uint16Array,Wr=Uint32Array,Zr=new C([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ur=new C([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ie=new C([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),de=function(r,e){for(var t=new V(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Wr(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return[t,i]},Ce=de(Zr,2),Vr=Ce[0],st=Ce[1];Vr[28]=258,st[258]=28;var Ae=de(Ur,0),ye=Ae[0],tn=Ae[1],Ar=new V(32768);for(l=0;l<32768;++l)N=(l&43690)>>>1|(l&21845)<<1,N=(N&52428)>>>2|(N&13107)<<2,N=(N&61680)>>>4|(N&3855)<<4,Ar[l]=((N&65280)>>>8|(N&255)<<8)>>>1;var N,l,X=function(r,e,t){for(var n=r.length,i=0,o=new V(e);i<n;++i)r[i]&&++o[r[i]-1];var s=new V(e);for(i=0;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var c;if(t){c=new V(1<<e);var a=15-e;for(i=0;i<n;++i)if(r[i])for(var u=i<<4|r[i],h=e-r[i],p=s[r[i]-1]++<<h,D=p|(1<<h)-1;p<=D;++p)c[Ar[p]>>>a]=u}else for(c=new V(n),i=0;i<n;++i)r[i]&&(c[i]=Ar[s[r[i]-1]++]>>>15-r[i]);return c},fr=new C(288);for(l=0;l<144;++l)fr[l]=8;var l;for(l=144;l<256;++l)fr[l]=9;var l;for(l=256;l<280;++l)fr[l]=7;var l;for(l=280;l<288;++l)fr[l]=8;var l,we=new C(32);for(l=0;l<32;++l)we[l]=5;var l;var xe=X(fr,9,1);var Se=X(we,5,1),dr=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},E=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Cr=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Te=function(r){return(r+7)/8|0},yr=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new(r.BYTES_PER_ELEMENT==2?V:r.BYTES_PER_ELEMENT==4?Wr:C)(t-e);return n.set(r.subarray(e,t)),n};var Ee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],y=function(r,e,t){var n=new Error(e||Ee[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,y),!t)throw n;return n},De=function(r,e,t){var n=r.length;if(!n||t&&t.f&&!t.l)return e||new C(0);var i=!e||t,o=!t||t.i;t||(t={}),e||(e=new C(n*3));var s=function(Kr){var Hr=e.length;if(Kr>Hr){var qr=new C(Math.max(Hr*2,Kr));qr.set(e),e=qr}},c=t.f||0,a=t.p||0,u=t.b||0,h=t.l,p=t.d,D=t.m,k=t.n,rr=n*8;do{if(!h){c=E(r,a,1);var L=E(r,a+1,3);if(a+=3,L)if(L==1)h=xe,p=Se,D=9,k=5;else if(L==2){var Z=E(r,a,31)+257,K=E(r,a+10,15)+4,er=Z+E(r,a+5,31)+1;a+=14;for(var M=new C(er),tr=new C(19),g=0;g<K;++g)tr[Ie[g]]=E(r,a+g*3,7);a+=K*3;for(var O=dr(tr),lr=(1<<O)-1,H=X(tr,O,1),g=0;g<er;){var nr=H[E(r,a,lr)];a+=nr&15;var v=nr>>>4;if(v<16)M[g++]=v;else{var q=0,hr=0;for(v==16?(hr=3+E(r,a,3),a+=2,q=M[g-1]):v==17?(hr=3+E(r,a,7),a+=3):v==18&&(hr=11+E(r,a,127),a+=7);hr--;)M[g++]=q}}var _r=M.subarray(0,Z),U=M.subarray(Z);D=dr(_r),k=dr(U),h=X(_r,D,1),p=X(U,k,1)}else y(1);else{var v=Te(a)+4,T=r[v-4]|r[v-3]<<8,W=v+T;if(W>n){o&&y(0);break}i&&s(u+T),e.set(r.subarray(v,W),u),t.b=u+=T,t.p=a=W*8,t.f=c;continue}if(a>rr){o&&y(0);break}}i&&s(u+131072);for(var je=(1<<D)-1,Be=(1<<k)-1,wr=a;;wr=a){var q=h[Cr(r,a)&je],Y=q>>>4;if(a+=q&15,a>rr){o&&y(0);break}if(q||y(2),Y<256)e[u++]=Y;else if(Y==256){wr=a,h=null;break}else{var jr=Y-254;if(Y>264){var g=Y-257,ir=Zr[g];jr=E(r,a,(1<<ir)-1)+Vr[g],a+=ir}var xr=p[Cr(r,a)&Be],Sr=xr>>>4;xr||y(3),a+=xr&15;var U=ye[Sr];if(Sr>3){var ir=Ur[Sr];U+=Cr(r,a)&(1<<ir)-1,a+=ir}if(a>rr){o&&y(0);break}i&&s(u+131072);for(var Br=u+jr;u<Br;u+=4)e[u]=e[u-U],e[u+1]=e[u+1-U],e[u+2]=e[u+2-U],e[u+3]=e[u+3-U];u=Br}}t.l=h,t.p=wr,t.b=u,t.f=c,h&&(c=1,t.m=D,t.d=p,t.n=k)}while(!c);return u==e.length?e:yr(e,0,u)};var ct=new C(0);var ut=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},ve=function(r,e,t){for(var n=r(),i=r.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),s=0;s<n.length;++s){var c=n[s],a=o[s];if(typeof c=="function"){e+=";"+a+"=";var u=c.toString();if(c.prototype)if(u.indexOf("[native code]")!=-1){var h=u.indexOf(" ",8)+1;e+=u.slice(h,u.indexOf("(",h))}else{e+=u;for(var p in c.prototype)e+=";"+a+".prototype."+p+"="+c.prototype[p].toString()}else e+=u}else t[a]=c}return[e,t]},mr=[],ft=function(r){var e=[];for(var t in r)r[t].buffer&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},lt=function(r,e,t,n){var i;if(!mr[t]){for(var o="",s={},c=r.length-1,a=0;a<c;++a)i=ve(r[a],o,s),o=i[0],s=i[1];mr[t]=ve(r[c],o,s)}var u=ut({},mr[t][1]);return at(mr[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,u,ft(u),n)},ht=function(){return[C,V,Wr,Zr,Ur,Ie,Vr,ye,xe,Se,Ar,Ee,X,dr,E,Cr,Te,yr,y,De,Fr,Pe,ze]};var Pe=function(r){return postMessage(r,[r.buffer])},ze=function(r){return r&&r.size&&new C(r.size)},pt=function(r,e,t,n,i,o){var s=lt(t,n,i,function(c,a){s.terminate(),o(c,a)});return s.postMessage([r,e],e.consume?[r.buffer]:[]),function(){s.terminate()}};var R=function(r,e){return r[e]|r[e+1]<<8},P=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},Nr=function(r,e){return P(r,e)+P(r,e+4)*4294967296};function vt(r,e,t){return t||(t=e,e={}),typeof t!="function"&&y(7),pt(r,e,[ht],function(n){return Pe(Fr(n.data[0],ze(n.data[1])))},1,t)}function Fr(r,e){return De(r,e)}var kr=typeof TextDecoder<"u"&&new TextDecoder,gt=0;try{kr.decode(ct,{stream:!0}),gt=1}catch{}var mt=function(r){for(var e="",t=0;;){var n=r[t++],i=(n>127)+(n>223)+(n>239);if(t+i>r.length)return[e,yr(r,t-1)];i?i==3?(n=((n&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|r[t++]&63):e+=String.fromCharCode((n&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(n)}};function It(r,e){if(e){for(var t="",n=0;n<r.length;n+=16384)t+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return t}else{if(kr)return kr.decode(r);var i=mt(r),o=i[0],s=i[1];return s.length&&y(8),o}}var dt=function(r,e){return e+30+R(r,e+26)+R(r,e+28)},Ct=function(r,e,t){var n=R(r,e+28),i=It(r.subarray(e+46,e+46+n),!(R(r,e+8)&2048)),o=e+46+n,s=P(r,e+20),c=t&&s==4294967295?At(r,o):[s,P(r,e+24),P(r,e+42)],a=c[0],u=c[1],h=c[2];return[R(r,e+10),a,u,i,o+R(r,e+30)+R(r,e+32),h]},At=function(r,e){for(;R(r,e)!=1;e+=4+R(r,e+2));return[Nr(r,e+12),Nr(r,e+4),Nr(r,e+20)]};var ge=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(r){r()};function Re(r,e,t){t||(t=e,e={}),typeof t!="function"&&y(7);var n=[],i=function(){for(var v=0;v<n.length;++v)n[v]()},o={},s=function(v,T){ge(function(){t(v,T)})};ge(function(){s=t});for(var c=r.length-22;P(r,c)!=101010256;--c)if(!c||r.length-c>65558)return s(y(13,0,1),null),i;var a=R(r,c+8);if(a){var u=a,h=P(r,c+16),p=h==4294967295||u==65535;if(p){var D=P(r,c-12);p=P(r,D)==101075792,p&&(u=a=P(r,D+32),h=P(r,D+48))}for(var k=e&&e.filter,rr=function(v){var T=Ct(r,h,p),W=T[0],Z=T[1],K=T[2],er=T[3],M=T[4],tr=T[5],g=dt(r,tr);h=M;var O=function(H,nr){H?(i(),s(H,null)):(nr&&(o[er]=nr),--a||s(null,o))};if(!k||k({name:er,size:Z,originalSize:K,compression:W}))if(!W)O(null,yr(r,g,g+Z));else if(W==8){var lr=r.subarray(g,g+Z);if(Z<32e4)try{O(null,Fr(lr,new C(K)))}catch(H){O(H,null)}else n.push(vt(lr,{size:K},O))}else O(y(14,"unknown compression type "+W,1),null);else O(null,null)},L=0;L<u;++L)rr(L)}else s(null,{});return i}var ke=require("fs"),G=require("fs/promises"),$=require("path");ur();f();function Ge(r){function e(s,c,a,u){let h=0;return h+=s<<0,h+=c<<8,h+=a<<16,h+=u<<24>>>0,h}if(r[0]===80&&r[1]===75&&r[2]===3&&r[3]===4)return r;if(r[0]!==67||r[1]!==114||r[2]!==50||r[3]!==52)throw new Error("Invalid header: Does not start with Cr24");let t=r[4]===3,n=r[4]===2;if(!n&&!t||r[5]||r[6]||r[7])throw new Error("Unexpected crx format version number.");if(n){let s=e(r[8],r[9],r[10],r[11]),c=e(r[12],r[13],r[14],r[15]),a=16+s+c;return r.subarray(a,r.length)}let o=12+e(r[8],r[9],r[10],r[11]);return r.subarray(o,r.length)}f();var Oe=Er(require("https"));function Lr(r,e={}){return new Promise((t,n)=>{Oe.default.get(r,e,i=>{let{statusCode:o,statusMessage:s,headers:c}=i;if(o>=400)return void n(`${o}: ${s} - ${r}`);if(o>=300)return void t(Lr(c.location,e));let a=[];i.on("error",n),i.on("data",u=>a.push(u)),i.once("end",()=>t(Buffer.concat(a)))})})}var yt=(0,$.join)(Rr,"ExtensionCache");async function wt(r,e){return await(0,G.mkdir)(e,{recursive:!0}),new Promise((t,n)=>{Re(r,(i,o)=>{if(i)return void n(i);Promise.all(Object.keys(o).map(async s=>{if(s.startsWith("_metadata/"))return;if(s.endsWith("/"))return void(0,G.mkdir)((0,$.join)(e,s),{recursive:!0});let c=s.split("/"),a=c.pop(),u=c.join("/"),h=(0,$.join)(e,u);u&&await(0,G.mkdir)(h,{recursive:!0}),await(0,G.writeFile)((0,$.join)(h,a),o[s])})).then(()=>t()).catch(s=>{(0,G.rm)(e,{recursive:!0,force:!0}),n(s)})})})}async function We(r){let e=(0,$.join)(yt,`${r}`);try{await(0,G.access)(e,ke.constants.F_OK)}catch{let n=r==="fmkadmapgofadopljbjfkapdkoienihi"?"https://raw.githubusercontent.com/Vendicated/random-files/f6f550e4c58ac5f2012095a130406c2ab25b984d/fmkadmapgofadopljbjfkapdkoienihi.zip":`https://clients2.google.com/service/update2/crx?response=redirect&acceptformat=crx2,crx3&x=id%3D${r}%26uc&prodversion=32`,i=await Lr(n,{headers:{"User-Agent":"Vencord (https://github.com/Vendicated/Vencord)"}});await wt(Ge(i),e).catch(console.error)}Ne.session.defaultSession.loadExtension(e)}vr||B.app.whenReady().then(()=>{B.protocol.registerFileProtocol("vencord",({url:n},i)=>{let o=n.slice(10);switch(o.endsWith("/")&&(o=o.slice(0,-1)),o){case"renderer.js.map":case"vencordDesktopRenderer.js.map":case"preload.js.map":case"patcher.js.map":case"vencordDesktopMain.js.map":i((0,_e.join)(__dirname,o));break;default:i({statusCode:403})}});try{gr().enableReactDevtools&&We("fmkadmapgofadopljbjfkapdkoienihi").then(()=>console.info("[Vencord] Installed React Developer Tools")).catch(n=>console.error("[Vencord] Failed to install React Developer Tools",n))}catch{}let r=n=>{let i={};return n.split(";").forEach(o=>{let[s,...c]=o.trim().split(/\s+/g);s&&!Object.prototype.hasOwnProperty.call(i,s)&&(i[s]=c)}),i},e=n=>Object.entries(n).filter(([,i])=>i?.length).map(i=>i.flat().join(" ")).join("; ");function t(n,i){if(i in n){let o=r(n[i][0]);for(let s of["style-src","connect-src","img-src","font-src","media-src","worker-src"])o[s]=["*","blob:","data:","'unsafe-inline'"];o["script-src"]??=[],o["script-src"].push("'unsafe-eval'","https://unpkg.com","https://cdnjs.cloudflare.com"),n[i]=[e(o)]}}B.session.defaultSession.webRequest.onHeadersReceived(({responseHeaders:n,resourceType:i},o)=>{n&&(i==="mainFrame"&&t(n,"content-security-policy"),i==="stylesheet"&&(n["content-type"]=["text/css"])),o({cancel:!1,responseHeaders:n})}),B.session.defaultSession.webRequest.onHeadersReceived=()=>{}});Me();
//# sourceURL=VencordPatcher
//# sourceMappingURL=vencord://patcher.js.map
/*! For license information please see patcher.js.LEGAL.txt */
